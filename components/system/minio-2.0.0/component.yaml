

components:

  - name: minio
    version: 2.0.0
    protected: true
    parametersSchema:
      file: _parameters_schema_.yaml
    config:
      source:
        interval: "2m"
      timeout:  "5m"
      install:
        createNamespace: true
        remediation:
          retries: 30
          remediateLastFailure: true
      upgrade:
        remediation:
          retries: 30
          remediateLastFailure: true
    source:
      defaultVersion: 5.2.0
      allowedVersions:
        - 5.2.0
      gitRepository:
        name: kad-components
        path: ./charts/minio/{version}/
    allowValues: true
    dependsOn:
      - ingress
      - blockStorage
    parameters:
      rootUser: # TBD
      rootPassword: # TBD
      storage:
        driveSize: # TBD
        replicas: # TBD
        drivesPerNode: 1
        pools: 1
      clusterIssuer: # TBD
      storageClass: # TBD
      # SSL passthrough, so the CA is the 'main' clusterIssuer
      ingresses:
        passthrough:
          enabled: true
          url: # TBD
        console:
          enabled: true
          url: # TBD
          clusterIssuer: # TBD
        # The following ingress is intended to allow access with another CA, typically public.
        # To use if minio is setup with a private cert. But as SSL is decoded/re-encoded, there is a performance penalty.
        alternate:
          enabled: false
          url: # TBD
          clusterIssuer: # TBD
        unsec:
          enabled: false
          url: TBD
      environment:
    values: |
      minio:
        rootUser: {{ .Parameters.rootUser }}
        rootPassword: {{ .Parameters.rootPassword }}
        clusterIssuer: {{ .Parameters.clusterIssuer }}
        tls:
          enabled: true
        persistence:
          storageClass: {{ .Parameters.storageClass }}
          size: {{ .Parameters.storage.driveSize }}
        drivesPerNode: {{ .Parameters.storage.drivesPerNode }}
        replicas: {{ .Parameters.storage.replicas }}
        mode: {{ if ne .Parameters.storage.replicas 1 }}distributed{{else}}standalone{{end}}
        pools: {{ .Parameters.storage.pools }}
        ingress:
          enabled: {{ .Parameters.ingresses.passthrough.enabled }}
          hosts:
            - {{ .Parameters.ingresses.passthrough.url }}
        consoleIngress:
          enabled: {{ .Parameters.ingresses.console.enabled }}
          annotations:
            cert-manager.io/cluster-issuer: {{ .Parameters.ingresses.console.clusterIssuer }}
          hosts:
            - {{ .Parameters.ingresses.console.url }}
          tls:
            - secretName: {{ .Meta.componentRelease.name }}-console-tls
              hosts:
                - {{ .Parameters.ingresses.console.url }}
        ingressExt:
          enabled: {{ .Parameters.ingresses.alternate.enabled }}
          clusterIssuer: {{  .Parameters.ingresses.alternate.clusterIssuer }}
          host: {{ .Parameters.ingresses.alternate.url }}
        ingressUnsec:
          enabled: {{ .Parameters.ingresses.unsec.enabled }}
          host: {{ .Parameters.ingresses.unsec.url }}
        {{- with .Parameters.environment }}
        environment:
          {{- toYaml . | nindent 6 }}
        {{- end }}
        users: []
